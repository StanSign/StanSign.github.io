---
title: 7)π“±iOSμ•±κ°λ° - API Gatewayλ΅ DBμ— μ •λ³΄ μ…λ ¥/μμ •ν•κΈ°
tags: [Assemble, SQL, AWS]
style: fill
color: secondary
description: AWS API Gatewayμ™€ Lambdaλ¥Ό ν™μ©ν•μ—¬ RDSμ— λ°μ΄ν„°λ¥Ό μ…λ ¥ν•΄λ³΄μ
---

DB ν‹€μ΄ μ–΄λμ •λ„ λ§μ¶°μ΅μΌλ‹ μ‹¤μ λ΅ λ°μ΄ν„°λ¥Ό λ„£μ–΄λ³΄λ ¤κ³  ν•©λ‹λ‹¤. μ΄μ „μ— λ§λ“¤μ–΄λ‘μ—λ Lambda ν•¨μμ™€ API Gatewayλ¥Ό μ‚¬μ©ν•λ©΄ RESTfulν•κ² λ°μ΄ν„°λ¥Ό μ…λ ¥ν•΄μ¤„ μ μμµλ‹λ‹¤.

### API Gateway

<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap01.png?raw=true" alt="api gateway" width="400">

μ„μ™€ κ°™μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•΄μ£Όκ³  PUT λ©”μ„λ“λ¥Ό μ¶”κ°€ν•΄μ£Όμ—μµλ‹λ‹¤. API Gatewayμ—μ„ μ§€μ›ν•λ” λ©”μ„λ“λ” μ΄ 6κ°€μ§€μΈλ°, HTTP λ©”μ„λ“μ™€ λ™μΌν• μ—­ν• μ„ ν•©λ‹λ‹¤.

---
#### HTTP Method

##### 1. ANY
μ•„λ λ‹¤μ„― λ©”μ„λ“ μ¤‘ μ ν•©ν• λ©”μ„λ“λ¥Ό κ³¨λΌ μ‹¤ν–‰ν•©λ‹λ‹¤.
##### 2. GET
λ°μ΄ν„°λ¥Ό μ΅°ν/κ²€μƒ‰ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. μ”μ²­μ‹μ— body κ°’κ³Ό content-type μ—†μ΄ urlμ— νλΌλ―Έν„°λ§ μ…λ ¥ν•μ—¬ μ‚¬μ©λ©λ‹λ‹¤λ‹¤. μ”μ²­μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λλ©΄ 200(OK) λ©”μ‹μ§€μ™€ ν•¨κ» body κ°’μ— λ°μ΄ν„°κ°€ μ €μ¥λμ–΄ λμ•„μµλ‹λ‹¤.
~~~
GET /films/2024012802
~~~
##### 3. POST
μƒλ΅μ΄ λ°μ΄ν„°λ¥Ό μƒμ„±ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. μ”μ²­μ‹μ— body κ°’κ³Ό content-typeμ„ ν•„μ”λ΅ ν•κ³ , μƒμ„±ν• λ•λ§ μ‚¬μ©λκΈ° λ•λ¬Έμ— μ΄λ―Έ μ¤‘λ³µλ λ°μ΄ν„°κ°€ μλ”λΌλ„ λ¬΄μ΅°κ±΄ μƒμ„±μ„ μ‹λ„ν•©λ‹λ‹¤. urlμ— λ¨λ“  λ°μ΄ν„°λ¥Ό λ„£λ” κ²ƒμ€ λ„λ¬΄λ‚ λ¶νΈν•κΈ° λ•λ¬Έμ— bodyμ— λ°μ΄ν„°λ¥Ό λ„£μ–΄ λ³΄λƒ…λ‹λ‹¤. μ„±κ³µμ μΌλ΅ λ°μ΄ν„°λ¥Ό μƒμ„±ν•λ©΄ 201(created) λ©”μ‹μ§€μ™€ ν•¨κ» body κ°’μ— μƒμ„±λ κ°’μ΄ μ €μ¥λμ–΄ λμ•„μµλ‹λ‹¤.
~~~
POST /films
body: {fID: 2023042403, fNM: "μν™”" ... }
content-type: "application/json"
~~~
##### 4. PUT
λ°μ΄ν„°λ¥Ό μ—…λ°μ΄νΈ/μƒμ„±ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. POSTμ™€ λΉ„μ·ν•μ§€λ§ μ΄λ―Έ μ΅΄μ¬ν•λ” λ°μ΄ν„°μ— λ€ν•΄μ„λ” μ—…λ°μ΄νΈκ°€ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤. (idempotent)
~~~
PUT /films/2023042403
body: {fNM: "μν™”2" ... }
content-type: "application/json"
~~~
##### 5. DELETE
μ΅΄μ¬ν•λ” λ°μ΄ν„°λ¥Ό μ‚­μ ν•  λ• μ‚¬μ©λ©λ‹λ‹¤. GETκ³Ό λΉ„μ·ν•κ² urlμ„ ν†µν•΄μ„ μ‚­μ ν•  λ°μ΄ν„°λ¥Ό νλΌλ―Έν„°λ΅ λ°›μµλ‹λ‹¤. μ„±κ³µμ μΌλ΅ λ°μ΄ν„°κ°€ μ‚­μ λλ©΄ λ³„λ„μ body λ‚΄μ© μ—†μ΄ μ„±κ³µ μ‘λ‹µλ§ λμ•„μµλ‹λ‹¤.
~~~
DELETE /films/2023042403
~~~
##### 6. HEAD
GET λ©”μ„λ“μ™€ λ™μΌν• κΈ°λ¥μ„ μν–‰ν•μ§€λ§ μ„λ²„κ°€ bodyλ¥Ό λ³΄λ‚΄μ£Όμ§€ μ•μµλ‹λ‹¤. λ³΄ν†µ μ„λ²„κ°€ μ •μƒμ μΌλ΅ μ‘λ™ν•λ”μ§€ ν™•μΈν•κΈ° μ„ν•΄ μ‘λ‹µ λ©”μ‹μ§€λ§μ„ ν™•μΈν•κ³  μ‹¶μ„ λ• μ‚¬μ©λ©λ‹λ‹¤.
~~~
HEAD /films/2021022302
~~~

---

<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap02.png?raw=true" alt="request" width="550">
λ‹¤μ‹ API Gatewayλ΅ λμ•„μ™€μ„, μƒμ„±ν• PUT λ©”μ„λ“λ¥Ό μ„ νƒν•κ³  ν†µν•© μ”μ²­μ— λ“¤μ–΄κ°‘λ‹λ‹¤.

<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap03.png?raw=true" alt="mapping template" width="550">
μ•„λμ λ§¤ν•‘ ν…ν”λ¦Ώμ„ ν†µν•΄ urlμ— μ–΄λ–¤ ν•μ‹μΌλ΅ νλΌλ―Έν„°λ¥Ό μ κ³µν•  κ²ƒμΈμ§€ μ„¤μ •ν•΄μ¤„ μ μμµλ‹λ‹¤. μ •μλ ν…ν”λ¦Ώμ΄ μ—†λ” κ²½μ° ν¨μ¤μ¤λ£¨λ¥Ό ν•λ„λ΅ μ„¤μ •ν•κ³  Content-TypeμΌλ΅λ” jsonμ„ μ…λ ¥ν•΄μ¤λ‹λ‹¤.

~~~
{
    "movieCd": "$input.params().querystring.get('movieCd')",
    "univ": "$input.params().querystring.get('univ')"
}
~~~
μ„μ™€ κ°™μ΄ key ν•λ‚ν•λ‚ μ§μ ‘ μ…λ ¥ν•΄μ£Όμ—μµλ‹λ‹¤. loopλ¥Ό ν†µν•΄ ν•λ” λ°©λ²•λ„ μλ‹¤κ³  ν•λ”λ° μ•„μ§ μµμ™μΉ μ•μ•„ μΌλ‹¨μ€ μ΄λ ‡κ² μ§„ν–‰ν•΄λ³΄μ•μµλ‹λ‹¤. query string ν•νƒλ΅ input parameterλ¥Ό λ°›μ•„ lambda ν•¨μμ inputμΌλ΅ λ“¤μ–΄κ°€κ² λ©λ‹λ‹¤.

<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap04.png?raw=true" alt="test" width="550">
<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap05.png?raw=true" alt="query string" width="350">

ν…μ¤νΈλ΅ λ“¤μ–΄κ°€ μΏΌλ¦¬ λ¬Έμμ—΄μ— lambda ν•¨μμ μ…λ ¥μ— λ§λ” κ°’μ„ μ…λ ¥ν•΄μ£Όμ—μµλ‹λ‹¤. μ•„λμ ν…μ¤νΈ λ²„νΌμ„ λλ¬λ³΄λ©΄?

<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap06.png?raw=true" alt="test result" width="550">

μƒλ‹¨μ— μ…λ ¥λ μ”μ²­ urlμ΄ ν‘μ‹λκ³  μƒνƒ(200 ok), μ†μ” μ‹κ°„, lambda ν•¨μμ—μ„ μ‘μ„±ν• μ¶λ ¥μ΄ ν‘μ‹λ©λ‹λ‹¤.

μ—¬λ¬ ν…μ¤νΈλ¥Ό κ±°μ³ κ°’λ“¤μ΄ μ λ€λ΅ λ“¤μ–΄κ°€λ” κ²ƒμ„ ν™•μΈν•μ€μµλ‹λ‹¤.
<img src="https://github.com/StanSign/StanSign.github.io/blob/main/_posts/Assemble/220125_07/cap07.png?raw=true" alt="result talbe" width="550">